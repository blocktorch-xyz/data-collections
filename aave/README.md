# AAVE Data Collections ðŸ‘»
Examples of blocks containing data of transactions with AAVE protocol

## General description of the block data 
<details>
  <summary>Fields description</summary>
  
   [TODO: for the important fields enrich descriptions with the human touch]  
   
   _Generated by ChatGPT_, reach out if something doesn't make sense :)

- `ver`: The block version (Firehose versioning, afaik, disregard)
- `hash`: The block hash
- `number`: The block number
- `size`: The block size in bytes
- `header`: The block header which contains the following fields:
  - `parentHash`: The hash of the parent block
  - `uncleHash`: The hash of the uncles of the block
  - `coinbase`: The address that receives the block reward for mining the block
  - `stateRoot`: The root hash of the Merkle Patricia trie that encodes the state of the Ethereum world
  - `transactionsRoot`: The root hash of the Merkle Patricia trie that encodes the transactions included in the block
  - `receiptRoot`: The root hash of the Merkle Patricia trie that encodes the receipts of the transactions in the block
  - `logsBloom`: A Bloom filter of the logs of the transactions in the block
  - `difficulty`: The difficulty of mining the block
  - `totalDifficulty`: The total difficulty of the chain up to and including this block
  - `gasLimit`: The maximum amount of gas that can be used by transactions in the block
  - `gasUsed`: The total amount of gas used by transactions in the block
  - `timestamp`: The timestamp of the block
  - `extraData`: Extra data associated with the block
  - `mixHash`: The hash used for proof-of-work validation
  - `nonce`: The nonce used for proof-of-work validation
  - `hash`: The block hash
  - `baseFeePerGas`: The minimum gas price (in Gwei) required for a transaction to be included in the block.
  - `uncles`: The uncles of the block (i.e. blocks that are siblings of the parent block but are not included in the main chain).

- `transactionTraces`: Array of objects representing transaction traces within the block.
    - `to`: The recipient address of the transaction.
    - `nonce`: The nonce of the transaction.
    - `gasPrice`: The price of gas in wei for the transaction.
        - `bytes`: The price of gas in bytes.
    - `gasLimit`: The maximum amount of gas that can be used by the transaction.
    - `input`: The input data of the transaction.
    - `v`: The recovery identifier for the transaction.
    - `r`: The ECDSA signature r value for the transaction.
    - `s`: The ECDSA signature s value for the transaction.
    - `gasUsed`: The amount of gas used by the transaction.
    - `type`: The transaction type.
    - `accessList`: The access list for the transaction.
    - `maxFeePerGas`: The maximum fee per gas for the transaction.
        - `bytes`: The maximum fee per gas in bytes.
    - `maxPriorityFeePerGas`: The maximum priority fee per gas for the transaction.
        - `bytes`: The maximum priority fee per gas in bytes.
    - `index`: The index of the transaction within the block.
    - `hash`: The hash of the transaction.
    - `from`: The sender address of the transaction.
    - `returnData`: The return data of the transaction.
    - `publicKey`: The public key of the sender of the transaction.
    - `beginOrdinal`: The begin ordinal of the transaction.
    - `endOrdinal`: The end ordinal of the transaction.
    - `status`: The status of the transaction.
    - `receipt`: The receipt for the transaction.
        - `stateRoot`: The state root of the transaction.
        - `cumulativeGasUsed`: The cumulative gas used by the transaction.
        - `logsBloom`: The logs bloom for the transaction.
        - `logs`: The logs generated by the transaction.
            - `address`: The address of the contract that generated the log.
            - `topics`: The topics of the log.
            - `data`: The data of the log.
            - `index`: The index of the log within the receipt.
            - `blockIndex`: The index of the block containing the log.
            - `ordinal`: The ordinal of the log.
    - `calls`: The calls generated by the transaction.
        - `index`: The index of the call within the transaction.
        - `parentIndex`: The index of the parent call within the transaction.
        - `depth`: The depth of the call within the transaction.
        - `callType`: The type of the call.
        - `caller`: The address of the contract that made the call.
        - `address`: The address of the contract that was called.
        - `gasLimit`: The maximum amount of gas that can be used by the call.
        - `gasConsumed`: The amount of gas consumed by the call.
        - `returnData`: The return data of the call.
        - `input`: The input data of the call.
        - `executedCode`: Whether the code of the contract was executed by the call.
        - `suicide`: Whether the contract was destroyed by the call.
        - `keccakPreimages`: The keccak preimages generated by the call.
        - `storageChanges`: The changes to storage generated by the call.
        - `balanceChanges`: The changes to balances generated by the call.
            - `address`: The address whose balance was changed.
            - `oldValue`: The old balance of the address.
                - `bytes`: The old balance in bytes.
            - `newValue`: The new balance of the address.
                - `bytes`: The new balance in bytes.
            - `reason`: The reason for the balance change.
            - `ordinal`: The ordinal of the balance change.
        - `nonceChanges`: An array of objects describing any changes made to an account's nonce as a result of a call.
        - `logs`: An array of objects representing any logs generated by a call.
        - `codeChanges`: An array of objects representing any changes made to the contract code by a call.
        - `gasChanges`: An array of objects describing any changes made to the gas used by a call.
        - `statusFailed`: A boolean indicating whether the call failed or not.
        - `statusReverted`: A boolean indicating whether the call was reverted or not.
        - `failureReason`: A string describing the reason for the call failure, if any.
        - `stateReverted`: A boolean indicating whether the call caused any changes to be reverted or not.
        - `beginOrdinal`: The ordinal of the first instruction executed by the call.
        - `endOrdinal`: The ordinal of the last instruction executed by the call.
        - `accountCreations`: An array of objects representing any new accounts created by a call.
- `balanceChanges`: An array of objects describing any changes made to an account's balance by transactions in the block.
- `codeChanges`: An array of objects representing any changes made to the contract code by transactions in the block.

</details>

## Files difference
In [all_calls.json](all_calls.json) file there are all the blocks in range `[16590535; 16590790]` which contain at least one call made to the AAVE Pool contract (the main user facing contract of the protocol exposing liquidity management methods like `supply()`, `borrow()`, `repay()`, etc.)

In [borrow_calls.json](borrow_calls.json) file the same range `[16590535; 16590790]` of blocks is filtered out to leave only the blocks where users are borrowing tokens from the protocol.

No irrelevant transactions can be found in both files, only the specified AAVE Pool transactions. 

A lot of data is present there to be explored, but following are some examples on how it might be used

## Examples of how the data might be used
### Setting an SLO to fire whenever borrow transaction consumes more than 350K of gas
One of the simplest examples, requiring just the tracking of the transaction's `gasUsed` value.

By setting a a threshold `gasUsed >= 350000` alert shall fire whenever such a condition is met.

In the existing file there are three different blocks where borrowing is taking place:
- in two of them ([1](borrow_calls.json#L46), [2](borrow_calls.json#L1790)) the amount of gas used is below our threshold
- in the [3rd one](borrow_calls.json#L3534) it exceeds the threshold

### Setting an SLO to fire whenever there is a borrowing transaction which leads to the USDC reserves falling beyond 1M
There is a possibility to see all the blockchain [storage changes](borrow_calls.json#L1691) which happened in the span of the transaction. Devs can set a metric tracking the amount of USDC reserves after each `borrow()` call to the protocol. To do we match the address of USDC token and the storage key representing the slot with AAVE balance of it: 
```json
"storageChanges": [
    {
        "address": "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",
        "key": "0x368c3f5f03e5634b3e4381c9c3caac98f4d254c7027fd14b53436c90d060fef4",
        "oldValue": "0x00000000000000000000000000000000000000000000000000000a04d45ed164",
        "newValue": "0x00000000000000000000000000000000000000000000000000000a03ce1c2564",
        "ordinal": 4727
    },
]
```
`newValue` then represents the amount of USDC left within the protocol after the borrowing operation has been processed. After setting a threshold `newValue <= 1M` alert shall fire whenever such a condition is met.